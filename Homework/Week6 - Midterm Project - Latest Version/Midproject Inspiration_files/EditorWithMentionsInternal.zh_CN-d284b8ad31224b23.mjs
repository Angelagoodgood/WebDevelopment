(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[35978],{199324:(e,t,o)=>{o.d(t,{Z:()=>n});const n=["-apple-system","BlinkMacSystemFont",'"Segoe UI"',"Roboto","Oxygen-Sans","Ubuntu","Cantarell",'"Fira Sans"','"Droid Sans"','"Helvetica Neue"',"Helvetica",'"ヒラギノ角ゴ Pro W3"','"Hiragino Kaku Gothic Pro"',"メイリオ","Meiryo",'"ＭＳ Ｐゴシック"',"Arial","sans-serif",'"Apple Color Emoji"','"Segoe UI Emoji"','"Segoe UI Symbol"'].join(",")},391254:(e,t,o)=>{o.d(t,{Z:()=>r});o(441143);var n=o(785893);class s{static factory(e){return e instanceof s?e:new s(String(e))}constructor(e){this._private_safe_value=e.trim().replace(">",">").replace("<","<").replace("&","&").replace('"','"').replace("'","'")}toString(){return this._private_safe_value}}function r(e){const{css:t,unsafeCSS:o,...r}=e,i=String(t||"")||o||"";return!!i?(0,n.jsx)("style",{...r,dangerouslySetInnerHTML:{__html:String(s.factory(i))}}):null}},367216:(e,t,o)=>{o.d(t,{Z:()=>a});var n=o(667294),s=o(391254),r=o(898781),i=o(883119),l=o(785893);function a({entryPointRef:e,isEmojiTrayOpen:t,onClick:o}){const[a,c]=(0,n.useState)(!1),u=(0,i.JZ)(),d=(0,r.ZP)(),_=a&&!u?{fontSize:"24px",animationName:"wiggle",animationDuration:"0.9s"}:{fontSize:"24px"};return(0,l.jsx)(i.xu,{display:"flex",justifyContent:"center",color:t?"secondary":"transparent",rounding:"circle",children:(0,l.jsxs)(i.iP,{accessibilityLabel:d.bt("选择表情", "Select an emoji", "emojitray.button.accessibilityLabel", undefined, true),rounding:"circle",onTap:()=>{null==o||o()},fullWidth:!1,onMouseEnter:()=>{c(!0)},onMouseLeave:()=>{c(!1)},children:[(0,l.jsx)(s.Z,{unsafeCSS:"@keyframes wiggle {\n        0% {transform: rotate(0deg);}\n        25% {transform: rotate(15deg);}\n        50% {transform: rotate(-15deg);}\n        75% {transform: rotate(15deg);}\n        100% {transform: rotate(0deg);}\n      }"}),(0,l.jsx)(i.xu,{alignItems:"center",display:"flex",dangerouslySetInlineStyle:{__style:_},height:40,justifyContent:"center",ref:e,width:40,children:"😃"})]})})}},720247:(e,t,o)=>{function n(e){let t=!1;return{promise:new Promise(((o,n)=>{e.then((e=>t?n({isCanceled:!0}):o(e)),(e=>n(t?{isCanceled:!0}:e)))})),cancel(){t=!0}}}o.d(t,{Z:()=>n})},342877:(e,t,o)=>{o.d(t,{Z:()=>r});var n=o(667294),s=o(720247);function r(){const e=(0,n.useRef)([]),t=(0,n.useRef)({});return(0,n.useEffect)((()=>()=>{[...Object.keys(t.current).map((e=>t.current[e])),...e.current].forEach((e=>e()))}),[]),function(o,n){if(n){const e=t.current[n];e&&(e(),delete t.current[n])}const{cancel:r,promise:i}=(0,s.Z)(o);return n?t.current[n]=r:e.current.push(r),i}}},400049:(e,t,o)=>{o.r(t),o.d(t,{default:()=>A,mentionComponent:()=>P});var n=o(667294),s=o(846888),r=o(199324),i=o(672586),l=o(367216),a=o(319915),c=o(116303),u=o(898781),d=o(883119),_=o(785893);const p=e=>{const t=(0,u.ZP)(),{id:o,isFocused:n,onMouseDown:s,onMouseEnter:r,onMouseUp:i,mention:l,role:a,searchValue:p}=e;return(0,_.jsx)("div",{id:o,onMouseDown:s,onMouseEnter:r,onMouseUp:i,searchvalue:p,role:a,children:(0,_.jsxs)(d.xu,{display:"flex",alignItems:"center",color:n?"secondary":"transparent",rounding:4,dangerouslySetInlineStyle:{__style:{cursor:"pointer"}},children:[(0,_.jsx)(d.xu,{padding:1,children:(0,_.jsx)(c.Z,{accessibilityLabel:"",name:l.full_name,size:"sm",src:l.image_medium_url,verified:l.verified_identity&&l.verified_identity.verified})}),(0,_.jsxs)(d.xu,{marginStart:2,marginEnd:2,overflow:"hidden",children:[(0,_.jsx)(d.xv,{lineClamp:1,weight:"bold",color:"default",children:l.full_name}),(0,_.jsx)(d.xu,{dangerouslySetInlineStyle:{__style:{whiteSpace:"nowrap"}},children:(0,_.jsxs)(d.xv,{size:"100",color:"default",children:[l.username,l.explicitly_followed_by_me&&` • ${t.bt("关注", "Following", "mentions.mentionsFlyout.following", undefined, true)}`]})})]})]})})};var m=o(412067),g=o(947599),y=o(941646),f=o(342877),h=o(19121),j=o(235872),x=o(681477),S=o(909041);const v=(0,n.lazy)((()=>o.e(65047).then(o.bind(o,965047)))),b=new d.Ry(661),C=new d.H3([b]),P=e=>(0,_.jsx)(d.xv,{inline:!0,color:"shopping",weight:"bold",children:e.children});function A({cursor:e,editorRef:t,focusOnMount:o,hasEmojiEntryPoint:c=!0,initialMentions:b=[],initialText:A="",instanceId:w,isUiUpdated:E=!1,maxSuggestions:z=j.SF,onAddMention:M,onBlur:k,onChange:R,onFocus:T,onPost:L,onSearchMentionCancel:Z,onSuggestionsPopoverClose:I,onSuggestionsPopoverOpen:D,placeholder:F,readOnly:U,spellCheck:O,statusType:H}){const B=(0,u.ZP)(),{isAuth:G}=(0,h.Z)(),W=(0,n.useRef)(114),N=(0,n.useRef)(null),X=(0,n.useRef)(null),K=null!=t?t:X,J=(0,n.useRef)(null),[$,q]=(0,n.useState)(!1),[V,Y]=(0,n.useState)(!1),[Q,ee]=(0,n.useState)([]),[{plugins:te,MentionSuggestions:oe}]=(0,n.useState)((()=>(()=>{const e=(0,s.ZP)({entityMutability:"IMMUTABLE",mentionComponent:P,mentionPrefix:"@",mentionTrigger:"@",positionSuggestions:x.ou,supportWhitespace:!1}),{MentionSuggestions:t}=e;return{plugins:[e],MentionSuggestions:t}})())),ne=(0,f.Z)(),[se,re]=(0,n.useState)(!1),[ie,le]=(0,n.useState)();(0,n.useEffect)((()=>{le(S.EditorState.createWithContent((0,x.RL)({text:A,mentions:b})))}),[w]),(0,n.useEffect)((()=>{q(!0)}),[]),(0,n.useEffect)((()=>{o&&K.current&&setTimeout((()=>{var e;le((e=>S.EditorState.moveSelectionToEnd(e))),null===(e=K.current)||void 0===e||e.focus()}),0)}),[$]);const ae=null==ie?void 0:ie.getCurrentContent().getPlainText(""),ce=(0,n.useCallback)((e=>{ee([]),M&&M(e)}),[]),ue=(0,n.useCallback)((e=>{k&&k(e),re(!1)}),[]),de=(0,n.useCallback)((e=>{var t,o,n;const s=e.getCurrentContent(),r=s.getPlainText(""),i=(0,x.lX)(s);le(e),R({text:r,mentions:i});const l=(null===(t=K.current)||void 0===t||null===(o=t.editor)||void 0===o||null===(n=o.editorContainer)||void 0===n?void 0:n.clientHeight)||0,a=N.current;l>114&&l>W.current&&a&&(a.scrollTop=a.scrollHeight,W.current=l)}),[]),_e=(0,n.useCallback)((()=>{T&&T()}),[]),pe=(0,n.useCallback)((()=>{Y(!1),I&&I()}),[]),me=(0,n.useCallback)((()=>{Y(!0),D&&D()}),[]),ge=(0,n.useCallback)(((e,t)=>{if(Z&&" "===e&&V&&Z(),Q.length>0)return"not-handled";const o=t.getCurrentContent(),n=t.getSelection();return de(S.EditorState.push(t,S.Modifier.replaceText(o,n,e),"adjust-depth")),"handled"}),[Q]),ye=(0,n.useCallback)((({value:e})=>{ne(m.Z.create("UserMentionTypeaheadResource",{query:e,num_people:z}).callGet(),"userMentionTypeahead").then((e=>{const t=(0,x.OC)({suggestions:e.resource_response.data});ee(t)})).catch((()=>{}))}),[]);return(0,_.jsx)(a.Z,{name:"EditorWithMentions",children:$&&(0,_.jsxs)(d.xu,{alignItems:"center",dangerouslySetInlineStyle:{__style:{fontFamily:r.Z}},"data-test-id":"editor-with-mentions",display:"flex",flex:"grow",minHeight:48,justifyContent:"between",width:"100%",children:[(0,_.jsx)(d.xu,{alignSelf:"textInFlightNested"===H?"start":"center",dangerouslySetInlineStyle:E?{__style:{cursor:e,paddingBottom:15,paddingLeft:"textStaticDisplay"===H?1:0,paddingTop:15}}:void 0,display:"flex",direction:"column",flex:"grow",marginStart:4,marginEnd:4,maxHeight:E?146:void 0,overflow:E?"auto":void 0,paddingX:E?0:1,ref:N,children:(0,_.jsx)(i.ZP,{ariaLabel:F,editorState:ie,onBlur:ue,onChange:de,onFocus:_e,handleBeforeInput:ge,placeholder:F,plugins:te,readOnly:U,ref:K,spellCheck:O,stripPastedStyles:!0})}),(0,_.jsx)(d.xu,{dangerouslySetInlineStyle:E?{__style:{paddingBottom:"textStaticDisplay"===H?6:5,paddingRight:"textStaticDisplay"===H?6:5,paddingTop:"textStaticDisplay"===H?6:5}}:void 0,children:E&&L&&ae?(0,_.jsx)(y.Z,{id:"activity-item-create-submit",children:(0,_.jsx)(d.hU,{accessibilityLabel:B.bt("发布", "post", "comment.composer.post", undefined, true),bgColor:"red",icon:"send",onClick:()=>{(async()=>{L&&await L()&&le(S.EditorState.createWithContent((0,x.RL)({text:"",mentions:[]})))})()},size:"md"})}):c&&(0,_.jsx)(l.Z,{isEmojiTrayOpen:se,onClick:()=>{G?re(!se):_e()},entryPointRef:J})}),(0,_.jsx)(oe,{onAddMention:ce,onClose:pe,onOpen:me,onSearchChange:ye,suggestions:Q,entryComponent:p}),se&&!!J&&(0,_.jsx)(g.Z,{children:(0,_.jsx)(d.mh,{zIndex:C,children:(0,_.jsx)(d.J2,{anchor:J.current,onDismiss:()=>{re(!1)},idealDirection:"up",size:"lg",showCaret:!0,positionRelativeToAnchor:!1,children:(0,_.jsx)(v,{onEmojiClick:e=>{if(ie){const t=ie.getCurrentContent(),o=ie.getSelection();de(S.EditorState.push(ie,S.Modifier.replaceText(t,o,e.emoji),"adjust-depth")),re(!se),_e()}},categories:[{category:"suggested",recently_used:B.bt("最近使用", "Recently Used", "emojitray.group.recently_used", undefined, true)},{category:"smileys_people",name:B.bt("笑脸与表情", "Smileys & People", "emojitray.group.smileys_people", undefined, true)},{category:"animals_nature",name:B.bt("动物与自然", "Animals & Nature", "emojitray.group.animals_nature", undefined, true)},{category:"food_drink",name:B.bt("饮食", "Food & Drink", "emojitray.group.food_drink", undefined, true)},{category:"travel_places",name:B.bt("旅游与景点", "Travel & Places", "emojitray.group.travel_places", undefined, true)},{category:"activities",name:B.bt("活动", "Activities", "emojitray.group.activities", undefined, true)},{category:"objects",name:B.bt("对象", "Objects", "emojitray.group.objects", undefined, true)},{category:"symbols",name:B.bt("符号", "Symbols", "emojitray.group.symbols", undefined, true)},{category:"flags",name:B.bt("旗帜", "Flags", "emojitray.group.flags", undefined, true)}]})})})})]})})}},235872:(e,t,o)=>{o.d(t,{N:()=>l,SF:()=>n,XN:()=>c,XU:()=>r,b7:()=>s,fL:()=>a,z5:()=>i});const n=5,s=5,r=1,i="var(--color-border-container)",l="var(--color-border-error)",a="var(--color-gray-roboflow-400)",c="4px solid #0084ff80"},681477:(e,t,o)=>{o.d(t,{OC:()=>u,RL:()=>a,lX:()=>c,ou:()=>d});var n=o(578510),s=o(883119),r=o(909041),i=o(121151),l=o(235872);const a=({text:e,mentions:t})=>{const o=[],n={},s=[];t&&t.forEach(((e,t)=>{const{length:o,offset:r,object_id:i}=e;n[t]={data:{mention:{id:i}},mutability:"IMMUTABLE",type:"mention"},s.push({key:t,length:o,offset:r})})),o.push({text:e,key:null,depth:null,inlineStyleRanges:null,type:"unstyled",entityRanges:s});return(0,r.convertFromRaw)({entityMap:n,blocks:o})},c=e=>{const t=[];let o=0;return e.getBlocksAsArray().forEach(((n,s)=>{let r=null;n.findEntityRanges((t=>{const o=t.getEntity();if(!o)return!1;const n=e.getEntity(o);return"mention"===n.getType()&&(r=n.data.mention,!0)}),((e,n)=>{r&&t.push({object_id:r.id,offset:o+e,length:n-e,tag_type:l.XU})})),o+=1+n.getLength()})),t},u=({suggestions:e})=>e.map((e=>({...e,name:e.username}))),d=({decoratorRect:e,popover:t,state:o,props:r,...l})=>{const a=(e.x||e.left)+t.offsetWidth,c=(e.y||e.top)+t.offsetHeight,{top:u,left:d}=(0,n.default)({decoratorRect:e,popover:t,state:o,props:r});let _=null;a>window.innerWidth&&(_=parseFloat(d)-a%window.innerWidth+"px");let p="",m=`${parseFloat(u)+5}px`;return c>window.innerHeight&&(p="translateY(-100%)",m=parseFloat(u)-20+"px"),{display:"block",top:m,left:_||d,zIndex:new s.H3([i.b7]).index(),transform:p}}}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/EditorWithMentionsInternal.zh_CN-d284b8ad31224b23.mjs.map